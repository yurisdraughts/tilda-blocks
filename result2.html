<style>
    .tarot-calculator-path-2 {
        width: 100vw;
        max-width: 430px;
        margin: 0 auto;
        font-family: "Nunito Sans", sans-serif;
        font-style: normal;
        border-radius: 20px;
        background: white;
    }

    .tarot-calculator-path-2,
    .tarot-calculator-path-2 * {
        box-sizing: border-box;
    }

    .tarot-calculator-path-2__form {
        padding: 11px 22px 0;
    }

    @media (max-width: 450px) {
        .tarot-calculator-path-2 {
            width: 90vw;
        }

        .tarot-calculator-path-2__form {
            padding: 2.2vw 4.4vw 0;
            width: 100%;
        }
    }

    .tc-block-path-2__label {
        display: block;
        font-weight: 400;
        font-size: 10px;
        line-height: 14px;
        text-align: center;
        width: 100%;
        color: #858585;
    }

    .tc-output-path-2 .tc-block-path-2__label {
        font-size: 11.3653px;
        line-height: 16px;
    }

    @media (max-width: 450px) {
        .tc-block-path-2__label {
            font-size: 2vw;
            line-height: 2.8vw;
        }

        .tc-output-path-2 .tc-block-path-2__label {
            font-size: 2.27306vw;
            line-height: 3.2vw;
        }
    }

    .tc-block-path-2__rect {
        text-align: center;
        border-radius: 10px;
        height: 32px;
    }

    .tc-block-path-2__rect_input {
        font-family: "Nunito Sans", sans-serif;
        font-style: normal;
        font-weight: 600;
        font-size: 16px;
        line-height: 22px;
        border: 1px solid #858585;
        width: 100%;
        color: #000000;
    }

    .tc-block-path-2__rect_date-input {
        letter-spacing: 0.12em;
        width: 100%;
    }

    .tc-block-path-2__rect_button {
        font-weight: 700;
        background: #494CFC;
        color: #FFFFFF;
        border: none;
        width: 100%;
        cursor: pointer;
    }

    @media (max-width: 450px) {
        .tc-block-path-2__rect_button {
            font-size: 3.2vw;
            line-height: 4.4vw;
        }
    }

    @media (max-width: 450px) {
        .tc-block-path-2__rect {
            border-radius: 2vw;
            height: 6.4vw;
        }
    }

    .tc-block-path-2__rect_output {
        font-weight: 600;
        font-size: 18.1845px;
        line-height: 25px;
        letter-spacing: 0.02em;
        color: #000000;
        padding-top: 5.685px;
        height: 36.37px;
        border-radius: 11.3653px;
    }

    @media (max-width: 450px) {
        .tc-block-path-2__rect_output {
            font-size: 3.6369vw;
            line-height: 5vw;
            padding-top: 1.137vw;
            height: 7.274vw;
            border-radius: 2.27306vw;
        }
    }

    .tc-block-path-2__rect_output_1 {
        background: #DBD6F9;
    }

    .tc-block-path-2__rect_output_2 {
        background: #DBD6F9;
    }

    .tc-block-path-2__rect_output_3 {
        background: #DBD6F9;
    }

    .tc-block-path-2__rect_output_4 {
        background: #DBD6F9;
    }

    .tc-block-path-2__rect_output_5 {
        background: #DBD6F9;
    }

    .tc-block-path-2__rect_output_6 {
        background: #DBD6F9;
    }

    .tc-block-path-2_output {
        width: 56.83px;
    }

    @media (max-width: 450px) {
        .tc-block-path-2_output {
            width: 11.366vw;
        }
    }

    .tc-form-path-2__input-wrapper {
        margin-bottom: 19px;
    }

    @media (max-width: 450px) {
        .tc-form-path-2__input-wrapper {
            margin-bottom: 3.6vw;
        }
    }

    .tc-form-path-2__date-input.has-error {
        border-color: #c64242;
        color: #c64242;
        outline-color: #c64242;
    }

    .tc-output-path-2 {
        position: relative;
        height: 282px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2 {
            height: 56.4vw;
        }
    }

    .tc-output-path-2>* {
        position: absolute;
    }

    .tc-output-path-2_decoration-2 {
        top: 138.29px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_decoration-2 {
            top: 27.658vw;
        }
    }

    .tc-output-path-2_decoration-2 {
        left: 113px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_decoration-2 {
            left: 22.6vw;
        }
    }

    .tc-output-path-2_decoration-2 {
        width: 204.58px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_decoration-2 {
            width: 40.916vw;
            height: 21.48vw;
        }
    }

    .tc-output-path-2_2 {
        left: 186.87px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_2 {
            left: 37.374vw;
        }
    }

    .tc-output-path-2_6 {
        left: 186.87px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_6 {
            left: 37.374vw;
        }
    }

    .tc-output-path-2_4 {
        left: 151.64px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_4 {
            left: 30.328vw;
        }
    }

    .tc-output-path-2_5 {
        left: 222.11px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_5 {
            left: 44.422vw;
        }
    }

    .tc-output-path-2_1 {
        left: 116.41px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_1 {
            left: 23.282vw;
        }
    }

    .tc-output-path-2_3 {
        left: 257.34px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_3 {
            left: 51.468vw;
        }
    }

    .tc-output-path-2_1 {
        top: 47.94px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_1 {
            top: 9.588vw;
        }
    }

    .tc-output-path-2_2 {
        top: 47.94px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_2 {
            top: 9.588vw;
        }
    }

    .tc-output-path-2_3 {
        top: 47.94px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_3 {
            top: 9.588vw;
        }
    }

    .tc-output-path-2_4 {
        top: 109.31px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_4 {
            top: 21.862vw;
        }
    }

    .tc-output-path-2_5 {
        top: 109.31px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_5 {
            top: 21.862vw;
        }
    }

    .tc-output-path-2_6 {
        top: 170.68px;
    }

    @media (max-width: 450px) {
        .tc-output-path-2_6 {
            top: 34.136vw;
        }
    }
</style>

<div class="tarot-calculator-path-2">
    <!-- <h2 class="tarot-calculator-path-2__heading"></h2> -->

    <form class="tarot-calculator-path-2__form tc-form-path-2" action="#" method="post">

        <div class="tc-form-path-2__input-wrapper">
            <div class="tc-block-path-2 tc-form-path-2__date-input-wrapper">
                <label class="tc-block-path-2__label">дата рождения</label>
                <input class="tc-block-path-2__rect tc-block-path-2__rect_input tc-block-path-2__rect_date-input tc-form-path-2__date-input"
                    type="text" name="date" inputmode="numeric">
            </div>
        </div>

        <div class="tc-block-path-2">
            <input class="tc-block-path-2__rect tc-block-path-2__rect_input tc-block-path-2__rect_button" type="submit" value="рассчитать">
        </div>
    </form>

    <div class="tarot-calculator-path-2__output tc-output-path-2">
        <div class="tc-block-path-2 tc-block-path-2_output tc-output-path-2_1">
            <div class="tc-block-path-2__label">1</div>
            <div class="tc-block-path-2__rect tc-block-path-2__rect_output tc-block-path-2__rect_output_1" data-position="1">XXII</div>
        </div>
        <div class="tc-block-path-2 tc-block-path-2_output tc-output-path-2_2">
            <div class="tc-block-path-2__label">2</div>
            <div class="tc-block-path-2__rect tc-block-path-2__rect_output tc-block-path-2__rect_output_2" data-position="2">XXII</div>
        </div>
        <div class="tc-block-path-2 tc-block-path-2_output tc-output-path-2_3">
            <div class="tc-block-path-2__label">3</div>
            <div class="tc-block-path-2__rect tc-block-path-2__rect_output tc-block-path-2__rect_output_3" data-position="3">XXII</div>
        </div>
        <div class="tc-block-path-2 tc-block-path-2_output tc-output-path-2_4">
            <div class="tc-block-path-2__label">4</div>
            <div class="tc-block-path-2__rect tc-block-path-2__rect_output tc-block-path-2__rect_output_4" data-position="4">XXII</div>
        </div>
        <div class="tc-block-path-2 tc-block-path-2_output tc-output-path-2_5">
            <div class="tc-block-path-2__label">5</div>
            <div class="tc-block-path-2__rect tc-block-path-2__rect_output tc-block-path-2__rect_output_5" data-position="5">XXII</div>
        </div>
        <div class="tc-block-path-2 tc-block-path-2_output tc-output-path-2_6">
            <div class="tc-block-path-2__label">6</div>
            <div class="tc-block-path-2__rect tc-block-path-2__rect_output tc-block-path-2__rect_output_6" data-position="6">XXII</div>
        </div>

        <svg class="tc-output-path-2_decoration-2" width="205" height="108" viewBox="0 0 205 108" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                d="M0.284158 0.365804C0.555932 0.208843 0.903491 0.301918 1.06045 0.573693L62.2691 106.555H102.288C102.602 106.555 102.856 106.81 102.856 107.124C102.856 107.437 102.602 107.692 102.288 107.692H61.613L0.0762684 1.1421C-0.0806925 0.870324 0.0123827 0.522765 0.284158 0.365804Z"
                fill="#D8D8D8" />
            <path fill-rule="evenodd" clip-rule="evenodd"
                d="M204.292 0.365804C204.02 0.208843 203.672 0.301918 203.515 0.573693L142.307 106.555H102.288C101.974 106.555 101.72 106.81 101.72 107.124C101.72 107.437 101.974 107.692 102.288 107.692H142.963L204.5 1.1421C204.657 0.870324 204.563 0.522765 204.292 0.365804Z"
                fill="#D8D8D8" />
        </svg>

    </div>
</div>

<script>
    "use strict";

    document.addEventListener('DOMContentLoaded', () => {
        const positions = document.querySelectorAll('.tc-output-path-2 [data-position]'),
            form = document.querySelector('.tc-form-path-2'),
            dateInput = document.querySelector('.tc-form-path-2 [name=date]'),
            convertToRoman = decimal => {
                const chart = [
                    ['X', 10],
                    ['IX', 9],
                    ['V', 5],
                    ['IV', 4],
                    ['I', 1]
                ];

                return chart.reduce((acc, numeral) => {
                    const [roman, remainder] = acc;
                    const [letter, value] = numeral;
                    return [
                        roman + letter.repeat(remainder / value),
                        remainder % value
                    ];
                }, ['', decimal])[0];

            },
            recalcPositions = (d, m, y, pathNum) => {
                const v = {},
                    digitSum = (...vals) => (
                        vals
                            .flatMap(val => val.toString().split(""))
                            .reduce((a, b) => a + parseInt(b), 0)
                    ),
                    recursiveSum = (...vals) => {
                        const result = digitSum(...vals);
                        return result < 10 ? result : recursiveSum(result);
                    },
                    mod22 = val => val % 22 !== 0 ? val % 22 : 22;

                v['1'] = mod22(d);
                v['2'] = m;
                v['3'] = mod22(digitSum(y));
                v['4'] = mod22(v['1'] + v['2']);
                v['5'] = mod22(v['2'] + v['3']);
                v['6'] = mod22(v['4'] + v['5']);

                for (const key of Object.keys(v)) {
                    if (key != `${pathNum}`) {
                        v[key] = mod22(v[key] + v[pathNum]);
                    }
                }

                for (let pos of positions) {
                    pos.innerHTML = convertToRoman(v[pos.dataset.position]);
                }
            },
            // Source: https://stackoverflow.com/a/55010378
            pattern = "__.__.____",
            dateInputMask = el => {
                const prev = [1, 2, 2, 4, 5, 5, 7, 8, 9, 10],
                    accept = /\d/g,
                    clean = input => {
                        input = input.match(accept) || [];
                        return Array.from(pattern, c =>
                            input[0] === c || c === "_" ? input.shift() || c : c
                        );
                    },
                    format = () => {
                        const [i, j] = [el.selectionStart, el.selectionEnd].map(i => {
                            i = clean(el.value.slice(0, i)).findIndex(c => c === "_");
                            return i < 0 ? prev[prev.length - 1] : back ? prev[i - 1] || 0 : i;
                        });
                        el.value = clean(el.value).join('');
                        el.setSelectionRange(i, j);
                        back = false;
                    };
                let back = false;

                el.addEventListener("keydown", (e) => back = e.key === "Backspace");
                el.addEventListener("input", format);
                el.addEventListener("focus", format);
                el.addEventListener("blur", () => el.value === pattern && (el.value = ""));
            };

        dateInputMask(dateInput);

        if (localStorage && localStorage.getItem('tarot_calculator-path-2')) {
            const localStorageValue = JSON.parse(localStorage.getItem('tarot_calculator-path-2'));
            dateInput.value = localStorageValue.date || '';
        }

        dateInput.addEventListener('keydown', event => {
            event.target.classList.remove('has-error');
        });

        form.addEventListener('submit', e => {
            e.preventDefault();
            dateInput.classList.remove('has-error');
            let hasError = false;

            if (dateInput.value === '' || dateInput.value === pattern) {
                return;
            }

            const date = dateInput.value.split('.').map(str => parseInt(str)),
                [d, m, y] = date,
                maxD = (new Date(y, m, 0)).getDate();

            if (
                d < 1 || d > maxD || isNaN(d)
                || m < 1 || m > 12 || isNaN(m)
                || y < 1500 || y > 2050 || isNaN(y)
            ) {
                dateInput.classList.add('has-error');
                hasError = true;
            }

            if (!hasError) {
                localStorage.removeItem('tarot_calculator-path-2');
                localStorage.setItem('tarot_calculator-path-2', JSON.stringify({
                    date: dateInput.value,
                }));
                recalcPositions(parseInt(d), parseInt(m), parseInt(y), 2);
            }
        });

        form.dispatchEvent(new FormDataEvent('submit', {
            formData: new FormData()
        }));
    });
</script>